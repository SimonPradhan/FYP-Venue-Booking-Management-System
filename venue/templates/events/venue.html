{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.0/main.min.css" rel="stylesheet" />

<div class="container">
    <a href="{% url 'venue:explore' %}" class="btn btn-primary mt-3 ml-3 mb-3">
        <i class="bi bi-arrow-left"></i> Back to Explore
    </a>
    <div class="row">
        <div class="d-flex justify-content-between">
            <!-- Image on the left side -->
            <div>
                <img src="/media/{{ venue.image }}" alt="{{ venue.name }} Image" class="img-fluid"
                    style="max-width: 400px" />
            </div>
            <div class="cols p-3">
                <div class="ml-4">
                    <h2>{{ venue.venuename }}</h2>
                    <ul class="list-unstyled">
                        <li><strong>Address:</strong> {{ venue.address }}</li>
                        <li><strong>Price:</strong> {{ venue.price }} (per plate)</li>
                        <li><strong>Capacity:</strong> {{ venue.capacity }} people</li>
                        <li><strong>Phone:</strong> {{ venue.phone }}</li>
                        <li><strong>Description:</strong> {{ venue.description }}</li>
                    </ul>
                    <!-- Add more details as needed -->

                    <!-- Back button to explore page with icon -->
                </div>
                <div class="buttons p-4">
                    <!-- chat now button -->
                    <a href="{% url 'chats:chat' %}" class="btn btn-primary">
                        <div class="row align-items-center jus">
                            <div class="col-2">
                                <i class="bi bi-chat-dots"></i>
                            </div>
                            <div class="col-2">Chat Now</div>
                        </div>
                    </a>
                    <!-- book now button  -->
                    <button class="btn btn-primary book-now-btn" data-bs-toggle="modal" data-bs-target="#bookingModal">
                        <div class="row align-items-center">
                            <div class="col-2">
                                <i class="bi bi-journal-bookmark"></i>
                            </div>
                            <div class="col-2">Book Now</div>
                        </div>
                    </button>

                </div>
            </div>
            <!-- Details on the right side -->
        </div>
    </div>
    <div class="row mt-4">
        <!-- Calendar section -->
        <div class="col-md-6">
            <h3>Calendar</h3>
            <div id="calendar" style="height: 400px; border: 1px solid #ccc"></div>
        </div>

        <!-- Map section -->
        <div class="col-md-6 mb-3">
            <h3>Map</h3>
            <div id="map" style="height: 400px; border: 2px solid #000000"></div>
        </div>
    </div>

</div>



<!-- Booking Modal -->
<div class="modal fade right my-5" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bookingModalLabel">Booking Form</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i
                        class="bi bi-x"></i></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'venue:booking' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="eventName">Event Name:</label>
                        <input type="text" class="form-control" id="eventName" name="eventName" required>
                    </div>

                    <div class="form-group">
                        <label for="event">Event Type:</label>
                        <select class="form-select" id="event" name="eventType" required>
                            <option value="wedding">Wedding</option>
                            <option value="birthday">Birthday</option>
                            <option value="meeting">Meeting</option>
                            <option value="conference">Conference</option>
                            <option value="party">Party</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="date">Date:</label>
                        <input type="date" class="form-control" id="date" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="time">Time:</label>
                        <select name="time" id="time">
                            <option value="10:00">-- --</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="12:00">12:00</option>
                            <option value="13:00">13:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                            <option value="21:00">21:00</option>
                            <option value="22:00">22:00</option>
                        </select>
                        <!-- <input type="time" class="form-control" id="time" name="time" min="10:00" max="22:00" required> -->
                    </div>

                    <div class="form-group">
                        <label for="guests">Number of Guests:</label>
                        <input type="number" class="form-control" id="guests" name="guests" required>
                    </div>

                    <div class="form-group">
                        <label for="message">Special Request:</label>
                        <textarea class="form-control" id="message" name="message" rows="3"></textarea>
                    </div>

                    <div class="cost" id="cost">
                        <h4>Cost: $</h4>
                    </div>

                    <button type="submit" value="Book"   class="btn btn-primary bookNowButton" id="bookNowButton">Book Now</button>

                </form>

               
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.0/fullcalendar.min.js"></script>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    total_costs = venue.price * document.getElementById('guests');
    document.getElementById('cost').innerHTML = "<h4>Cost: $" + total_costs + "</h4>";
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth', // Display mode: Month view
            events: [
                // Example events
                {
                    title: 'Event 1',
                    start: '2024-04-01', // Event start date
                    end: '2024-04-02' // Event end date
                },
                {
                    title: 'Event 2',
                    start: '2024-04-05', // Event start date
                    end: '2024-04-07' // Event end date
                }
                // Add more events as needed
            ]
        });
        calendar.render();
    });
</script>

<script defer >
   
  
    document.getElementById("date").addEventListener("change", function() {
   
    const chosenDate = new Date(this.value);
 
    // console.log(chosenDate);
    if (chosenDate >= new Date()) {
        document.getElementById("bookNowButton").disabled = false;
    } else {
        document.getElementById("bookNowButton").disabled = true;
    }
    const bookingData = {{ booking_data|safe }};
   
    var bookingsForSelectedDate,timesForSelectedDate = [];
    console.log(bookingsForSelectedDate)
    // Get the select element
    var selectElement = document.getElementById('time');
    
    // Get the selected date
    var selectedDate = document.getElementById('date').value;
    
    // Filter booking data for the selected date
    bookingsForSelectedDate = bookingData.filter(booking => booking.date === selectedDate);
  
    // Extract time values for the selected date
    timesForSelectedDate = bookingsForSelectedDate.map(booking => booking.time);

    // Disable options based on the list
    for (var i = 0; i < selectElement.options.length; i++) {
        var option = selectElement.options[i];
        if (timesForSelectedDate.includes(option.value)) {
            option.disabled = true;
        }
        else{
            option.disabled = false;
        
        }
    }
});

// Define the coordinates of the desired location
// Define the name of the place you want to search
var placeName = "{{venue.address}}"; // Example place name

// Make a request to the Nominatim API to search for the place name
fetch('https://nominatim.openstreetmap.org/search?q=' + encodeURIComponent(placeName) + '&format=json')
  .then(response => response.json())
  .then(data => {
    // Check if the response contains any results
    if (data && data.length > 0) {
      // Extract the latitude and longitude from the first result
      var latitude = data[0].lat;
      var longitude = data[0].lon;
      
      // Initialize the map with the view set to the desired location
      var map = L.map('map').setView([latitude, longitude], 18); // Set initial coordinates and zoom level

      // Add a tile layer (OpenStreetMap tile layer)
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
          maxZoom: 100
      }).addTo(map);
    } else {
      console.log("No results found for the place name:", placeName);
    }
  })
  .catch(error => {
    console.error("Error fetching data from the Nominatim API:", error);
  });

    // List of values to disable
    
    // document.getElementById("bookNowButton").addEventListener("click", targetVenuebooking());    
</script>


{% endblock %}